<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard partners | Client Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="./src/theme-intra.css">
    <link rel="stylesheet" href="./src/style.css">
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container full-width-layout">
        <!-- Main Header -->
        <header class="main-header">
            <div class="header-left">
                <div class="client-branding">
                    <img id="client-logo" src="" alt="Client Logo" class="client-logo-img hidden">
                    <div class="welcome-area">
                        <span class="welcome-label">Bienvenido,</span>
                        <h2 class="welcome-name" id="welcome-name">Administrador</h2>
                    </div>
                </div>
            </div>

            <div class="header-right">
                <div class="intra-branding">
                    <img src="src/assets/intra-logo.png" alt="Intra" class="intra-logo-img">
                    <span class="partner-tag">Partner Portal</span>
                </div>
                <button onclick="logout()" class="logout-btn" title="Cerrar sesión">
                    <ion-icon name="log-out-outline"></ion-icon>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header-row">
                <div class="header-title-area">
                    <div class="live-label">
                        <div class="live-dot"></div>
                        <span>Última actualización: Ahora mismo</span>
                    </div>
                    <h1 class="section-headline">
                        Dashboard <ion-icon name="globe-outline" class="globe-icon"></ion-icon>
                    </h1>
                </div>

                <!-- Global Range Selector -->
                <div class="global-range-selector">
                    <div class="range-display" id="range-picker-toggle">
                        <ion-icon name="calendar-outline"></ion-icon>
                        <span id="current-range-label">Todo el tiempo</span>
                        <ion-icon name="chevron-down-outline" class="chevron"></ion-icon>
                    </div>

                    <div class="range-dropdown hidden" id="range-dropdown">
                        <div class="custom-range-inputs">
                            <span class="label">Seleccionar rango personalizado:</span>
                            <div class="inputs-row">
                                <input type="text" id="date-range-picker" class="range-input-field full-width"
                                    placeholder="Clic para abrir calendario..." readonly>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <button class="range-opt" data-range="today">Hoy</button>
                        <button class="range-opt" data-range="7d">Últimos 7 días</button>
                        <button class="range-opt" data-range="30d">Últimos 30 días</button>
                        <button class="range-opt" data-range="this-month">Este mes</button>
                        <button class="range-opt" data-range="last-month">Mes pasado</button>
                        <button class="range-opt" data-range="all">Todo el tiempo</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">

                <!-- Cards Row -->
                <div class="cards-grid">
                    <!-- Card 1: Leads Calificados -->
                    <div class="card-quantix card-orange">
                        <div class="card-accent-line orange"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3); color: #F59E0B;">
                                    <ion-icon name="ribbon"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub">CALIDAD</span>
                                    <span class="label-main">Oportunidades calificadas</span>
                                </div>
                            </div>
                        </div>

                        <div class="value-big" id="card-1-value">0</div>
                        <div class="pill-change pill-green">
                            <ion-icon name="arrow-up"></ion-icon> High Quality
                        </div>

                        <div class="card-chart-container">
                            <canvas id="chart-1"></canvas>
                        </div>
                    </div>

                    <!-- Card 2: Tasa de Conversión -->
                    <div class="card-quantix card-purple">
                        <div class="card-accent-line purple"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(117, 81, 255, 0.1); border-color: rgba(117, 81, 255, 0.3); color: #7551FF;">
                                    <ion-icon name="swap-vertical"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub">Oportunidades calificadas / Leads</span>
                                    <span class="label-main">Tasa de Conversión</span>
                                </div>
                            </div>
                        </div>

                        <div class="value-big" id="card-2-value">0.0</div>
                        <div class="pill-change pill-green"
                            style="background: rgba(117, 81, 255, 0.15); color: #7551FF;">
                            Ratio Actual
                        </div>

                        <div class="card-chart-container">
                            <canvas id="chart-2"></canvas>
                        </div>
                    </div>

                    <!-- Card 3: Ventas -->
                    <div class="card-quantix card-cyan">
                        <div class="card-accent-line cyan"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(1, 241, 227, 0.1); border-color: rgba(1, 241, 227, 0.3); color: #01F1E3;">
                                    <ion-icon name="cash"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub">INGRESOS TOTALES</span>
                                    <span class="label-main">Ventas</span>
                                </div>
                            </div>
                        </div>

                        <div class="value-big" id="card-3-value">$0</div>
                        <div class="pill-change" style="visibility: hidden;">Spacer</div>

                        <div class="card-chart-container">
                            <canvas id="chart-3"></canvas>
                        </div>
                    </div>

                    <!-- Card 4: ROI -->
                    <div class="card-quantix card-pink">
                        <div class="card-accent-line pink"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(255, 0, 229, 0.1); border-color: rgba(255, 0, 229, 0.3); color: #FF00E5;">
                                    <ion-icon name="rocket"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub">VENTAS / INVERSIÓN</span>
                                    <span class="label-main">ROI</span>
                                </div>
                            </div>
                        </div>

                        <div class="value-big" id="card-4-value">0.0x</div>
                        <div class="pill-change" style="visibility: hidden;">Spacer</div>

                        <div class="card-chart-container">
                            <canvas id="chart-4"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Middle Row: Chart & Table (50/50) -->
                <div class="split-row-grid">
                    <!-- Main Big Chart -->
                    <div class="card-quantix big-chart-card">
                        <div class="card-header" style="margin-bottom: 20px;">
                            <div>
                                <span class="label-sub">TENDENCIA HISTÓRICA</span>
                                <h3 class="section-headline" style="font-size: 1.5rem; margin: 0;">Comportamiento</h3>
                            </div>
                        </div>
                        <div style="flex: 1; position: relative; width: 100%;">
                            <canvas id="main-chart"></canvas>
                        </div>
                    </div>

                    <!-- Table Card -->
                    <div class="table-card" style="display: flex; flex-direction: column;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; font-size: 1.1rem; color: var(--text-secondary);">Últimos leads
                                calificados
                            </h3>
                            <button id="view-all-btn" class="header-icon-btn" title="Ver info completa">
                                <ion-icon name="open-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="table-wrapper" style="border:none; padding:0; background:none;">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">#</th>
                                        <th>Nombre</th>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="leads-table-body">
                                    <!-- JS Injection -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bottom Row: Remaining Cards -->
                <div class="bottom-cards-row">
                    <!-- Card 5: Total Leads -->
                    <div class="card-quantix card-orange">
                        <div class="card-accent-line orange"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3); color: #F59E0B;">
                                    <ion-icon name="people"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub">Personas que mandaron mensaje</span>
                                    <span class="label-main">Total de Registros</span>
                                </div>
                            </div>
                        </div>
                        <div class="value-big" id="card-5-value">0</div>
                        <div class="pill-change pill-green">Generados</div>
                        <div class="card-chart-container"><canvas id="chart-5"></canvas></div>
                    </div>

                    <!-- Card 6: Inversión -->
                    <div class="card-quantix card-pink">
                        <div class="card-accent-line pink"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(255, 0, 229, 0.1); border-color: rgba(255, 0, 229, 0.3); color: #FF00E5;">
                                    <ion-icon name="wallet"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub"></span>
                                    <span class="label-main">Inversión</span>
                                </div>
                            </div>
                        </div>
                        <div class="value-big" id="card-6-value">$0</div>
                        <div class="pill-change pill-red">Presupuesto</div>
                        <div class="card-chart-container"><canvas id="chart-6"></canvas></div>
                    </div>

                    <!-- Card 7: CPL -->
                    <div class="card-quantix card-cyan">
                        <div class="card-accent-line cyan"></div>
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="icon-box"
                                    style="background: rgba(1, 241, 227, 0.1); border-color: rgba(1, 241, 227, 0.3); color: #01F1E3;">
                                    <ion-icon name="pricetag"></ion-icon>
                                </div>
                                <div class="label-group">
                                    <span class="label-sub"></span>
                                    <span class="label-main">Costo por oportunidad calificada</span>
                                </div>
                            </div>
                        </div>
                        <div class="value-big" id="card-7-value">$0.00</div>
                        <div class="pill-change pill-green">Eficiencia</div>
                        <div class="card-chart-container"><canvas id="chart-7"></canvas></div>
                    </div>
                </div>


                <!-- Modal Structure -->
                <div id="leads-modal" class="modal-overlay hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Detalle Completo de Leads</h3>
                            <button class="close-modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <table class="modal-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Nombre</th>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="modal-table-body">
                                    <!-- JS Injection -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        </main>

    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/config.js"></script>
    <script src="src/auth.js"></script>
    <script src="src/dashboard.js"></script>
    <footer style="text-align: center; padding: 20px; color: var(--text-dim); font-size: 0.8rem; opacity: 0.6;">
        &copy; 2026 Intra. Todos los derechos reservados.
    </footer>
</body>

</html>